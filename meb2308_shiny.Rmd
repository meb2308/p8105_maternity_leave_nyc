---
title: "Maternity Leave in NYC"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    source_code: embed
    runtime: shiny
---

```{r, include=FALSE}
library(tidyverse)
library(plotly)
library(flexdashboard)
library(shiny)
library(rsconnect)
library (tigris)
library(rgdal)
library(leaflet)

charts_df = 
  read_csv("./data/merged_wfls.csv") %>% 
  drop_na(borough, race, job_type, leave_type, education, partner, family_income)
```

Weeks of Leave Predictor
=====================================

Column {.sidebar}
-----------------------------------------------------------------------

```{r}
#all entries to choose from for predictor 
borough_choice = charts_df %>% 
  pull(borough) %>% unique()

race = charts_df %>% 
  pull(race) %>% unique()

partner = charts_df %>% 
  pull(partner) %>% unique()

education = charts_df %>% 
  pull(education) %>% unique()

employment = charts_df %>% 
  pull(job_type) %>% unique()

family_income = charts_df %>% 
  pull(family_income) %>% unique()

selectInput(
  "borough_choice",
  h3("Borough"),
  choices = borough_choice,
  selected = "Manhattan")
  
selectInput(
  "family_income",
  h3("Family Income"),
  choices = family_income,
  selected = "Less than $16,000")

radioButtons(
  "race",
  h3("Race"),
  choices = race)

radioButtons(
  "partner",
  h3("Co-parenting Status"),
  choices = partner)

radioButtons(
  "education",
  h3("Education"),
  choices = education)

radioButtons(
  "employment",
  h3("Employment Type"),
  choices = employment)
```

Column 
-----------------------------------------------------------------------

```{r}
renderPlotly({
  
charts_df = 
  charts_df %>% 
  filter(
    borough == input$borough_choice,
    race == input$race,
    job_type == input$employment,
    partner == input$partner,
    family_income == input$family_income,
    education == input$education)

charts_df %>% 
  mutate(
    mean_leave_weeks = mean(leave_weeks)) %>% 
  group_by(mean_leave_weeks, leave_type) %>% 
  plot_ly(
    x = ~leave_type, y = ~mean_leave_weeks, color = ~leave_type,
    type = "box", colors = "viridis") %>% 
  layout(
    title = "Weeks of Leave by Selected Characteristics",
    xaxis = list(title = "Type of Leave"),
    yaxis = list(title = ""))

 })

```

Socioeconomic Characteristics
=====================================

Column {.sidebar}
-----------------------------------------------------------------------

```{r}
# Choose two options to plot in bar chart format

selectInput(
  "geography",
  h3("Choose a geography"),
  choices = list("All of NYC", "Result by borough")
)

conditionalPanel(
  condition = "input.geography == 'Result by borough'",
    selectInput(
    "borough_choice",
    h3("Choose a borough"),
    choices = borough_choice))

selectInput(
  "choice_1",
  h3("Choose first characteristic"),
  choices = list("Race", "Employment Type", "Co-parenting Status", "Family Income"))

conditionalPanel(
  condition = "input.choice_1 == 'Race'",
  radioButtons(
  "race",
  h3("Race"),
  choices = race))

conditionalPanel(
  condition = "input.choice_1 == 'Employment Type'",
  radioButtons(
  "employment",
  h3("Employment Type"),
  choices = employment))

conditionalPanel(
  condition = "input.choice_1 == 'Co-parenting Status'",
  radioButtons(
  "partner",
  h3("Co-parenting Status"),
  choices = partner))

conditionalPanel(
  condition = "input.choice_1 == 'Education'",
  radioButtons(
  "education",
  h3("Education"),
  choices = education))

conditionalPanel(
  condition = "input.choice_1 == 'Family Income'",
  selectInput(
  "family_income",
  h3("Family Income"),
  choices = family_income,
  selected = "Less than $16,000"))

selectInput(
  "choice_2",
  h3("Choose second characteristic"),
  choices = list("Race", "Employment Type", "Co-parenting Status", "Family Income"))

conditionalPanel(
  condition = "input.choice_2 == 'Race'",
  radioButtons(
  "race",
  h3("Race"),
  choices = race))

conditionalPanel(
  condition = "input.choice_2 == 'Employment Type'",
  radioButtons(
  "employment",
  h3("Employment Type"),
  choices = employment))

conditionalPanel(
  condition = "input.choice_2 == 'Co-parenting Status'",
  radioButtons(
  "partner",
  h3("Co-parenting Status"),
  choices = partner))

conditionalPanel(
  condition = "input.choice_2 == 'Education'",
  radioButtons(
  "education",
  h3("Education"),
  choices = education))

conditionalPanel(
  condition = "input.choice_2 == 'Family Income'",
  selectInput(
  "family_income",
  h3("Family Income"),
  choices = family_income,
  selected = "Less than $16,000"))
```

Column
-----------------------------------------------------------------------

```{r}
renderPlotly({
  charts_df %>% 
  count(mean_leave_weeks) %>% 
  filter(
    borough %in% input$borough_choice
    ) %>% 
  plot_ly(
    x = ~input$choice_1, y = ~n, color = ~input$choice_2,
    type = "bar", colors = "viridis")
})
```

NYC Maps
===================================== 

Column {.sidebar}
-----------------------------------------------------------------------

```{r}

#entries to choose from
borough_choices = 
  charts_df %>% 
  pull(borough) %>%  
  unique()

selectInput(
  "borough_choice",
  h3("Borough"),
  choices = borough_choices,
  selected = "Manhattan")

selectInput(
  "choices",
  h3("Choose a characteristic"),
  choices = list("Race", "Employment Type", "Co-parenting Status", "Family Income"))

conditionalPanel(
  condition = "input.choices == 'Race'",
  radioButtons(
  "race",
  h3("Race"),
  choices = race))

conditionalPanel(
  condition = "input.choices == 'Employment Type'",
  radioButtons(
  "employment",
  h3("Employment Type"),
  choices = employment))

conditionalPanel(
  condition = "input.choices == 'Co-parenting Status'",
  radioButtons(
  "partner",
  h3("Co-parenting Status"),
  choices = partner))

conditionalPanel(
  condition = "input.choices == 'Education'",
  radioButtons(
  "education",
  h3("Education"),
  choices = education))

conditionalPanel(
  condition = "input.choices == 'Family Income'",
  selectInput(
  "family_income",
  h3("Family Income"),
  choices = family_income,
  selected = "Less than $16,000"))

# rsconnect::deployApp("./meb2308_shiny.Rmd")
```

Column
----------------------------------------------------------------------


