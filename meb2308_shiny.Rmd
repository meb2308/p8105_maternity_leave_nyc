---
title: "Maternity Leave in NYC"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    source_code: embed
    runtime: shiny
---

```{r, include=FALSE}
library(tidyverse)
library(plotly)
library(flexdashboard)
library(shiny)
library(rsconnect)
library (tigris)
library(rgdal)
library(leaflet)

#create general data frame for plots
charts_df = 
  read_csv("./data/merged_wfls.csv")

#create data frame with NAs removed
charts_df_2 = 
    read_csv("./data/merged_wfls.csv") %>% 
    mutate(mean_leave_weeks = mean(leave_weeks)) %>% 
    drop_na(borough, race, job_type, leave_type, education, partner, family_income)
```

By Neighborhood
=====================================

Column {.sidebar}
-----------------------------------------------------------------------

```{r}
#all entries to choose from for predictor 

borough_choice = charts_df %>% 
  pull(borough) %>% unique()

neighborhood = charts_df %>% 
  pull(neighborhood) %>% unique()

selectInput(
  "geography",
  h3("Choose a geography"),
  choices = list("All of NYC", "Result by borough", "Result by neighborhood"))

conditionalPanel(
  condition = "input.geography != 'All of NYC'",
    selectInput(
    "borough_choice",
    h3("Choose a borough"),
    choices = borough_choice))

rt<-reactive({
  charts_df %>%
  filter(borough == input$borough)
})

conditionalPanel(
  condition = "input.geography == 'Result by neighborhood'",
  selectInput(
    "neighborhood",
    h3("Choose a neighborhood"),
    choices = neighborhood))
```

Column 
-----------------------------------------------------------------------

```{r}
renderText({
  input[["borough_choice"]]
})

renderPlotly({
  
filtered_df <- 
  charts_df %>% 
  filter(
    borough == input$borough_choice
    ) %>% 
  group_by(leave_type) %>% 
  plot_ly(
    x = ~leave_type, y = ~leave_weeks, color = ~neighborhood,
    type = "box", colors = "viridis") %>%
  layout(
    title = "Weeks of Maternity Leave",
    xaxis = list(title = "Type of Leave"),
    yaxis = list(title = ""))

 })

```

By Key Socio-Demographics
=====================================

Column {.sidebar}
-----------------------------------------------------------------------

```{r}

race = charts_df_2 %>% 
  pull(race) %>% unique()

partner = charts_df_2 %>% 
  pull(partner) %>% unique()

education = charts_df_2 %>% 
  pull(education) %>% unique()

employment = charts_df_2 %>% 
  pull(job_type) %>% unique()

family_income = charts_df_2 %>% 
  pull(family_income) %>% unique()

# Choose two options to plot in bar chart format

selectInput(
  "choice_1",
  h3("Choose x-axis variable"),
  choices = list("Race", "Employment Type", "Co-parenting Status", "Family Income"))

conditionalPanel(
  condition = "input.choice_1 == 'Race'",
  radioButtons(
  "race",
  h3("Race"),
  choices = race))

conditionalPanel(
  condition = "input.choice_1 == 'Employment Type'",
  radioButtons(
  "employment",
  h3("Employment Type"),
  choices = employment))

conditionalPanel(
  condition = "input.choice_1 == 'Co-parenting Status'",
  radioButtons(
  "partner",
  h3("Co-parenting Status"),
  choices = partner))

conditionalPanel(
  condition = "input.choice_1 == 'Education'",
  radioButtons(
  "education",
  h3("Education"),
  choices = education))

conditionalPanel(
  condition = "input.choice_1 == 'Family Income'",
  selectInput(
  "family_income",
  h3("Family Income"),
  choices = family_income,
  selected = "Less than $16,000"))

selectInput(
  "choice_2",
  h3("Choose color group variable"),
  choices = list("Race", "Employment Type", "Co-parenting Status", "Family Income"))

conditionalPanel(
  condition = "input.choice_2 == 'Race'",
  radioButtons(
  "race",
  h3("Race"),
  choices = race))

conditionalPanel(
  condition = "input.choice_2 == 'Employment Type'",
  radioButtons(
  "employment",
  h3("Employment Type"),
  choices = employment))

conditionalPanel(
  condition = "input.choice_2 == 'Co-parenting Status'",
  radioButtons(
  "partner",
  h3("Co-parenting Status"),
  choices = partner))

conditionalPanel(
  condition = "input.choice_2 == 'Education'",
  radioButtons(
  "education",
  h3("Education"),
  choices = education))

conditionalPanel(
  condition = "input.choice_2 == 'Family Income'",
  selectInput(
  "family_income",
  h3("Family Income"),
  choices = family_income,
  selected = "Less than $16,000"))
```

Column
-----------------------------------------------------------------------

```{r}
renderPlotly({
plots <-
  charts_df %>% 
  filter(
    borough == input$borough_choice) %>%
  group_by(input$choice_1, input$choice_2) %>% 
  plot_ly(
    x = ~input$choice_1, y = ~mean_leave_weeks, color = ~input$choice_2,
    type = "bar", colors = "viridis")
})
```

NYC Maps
===================================== 

Column {.sidebar}
-----------------------------------------------------------------------

```{r}

#entries to choose from
borough_choices = 
  charts_df %>% 
  pull(borough) %>%  
  unique()

selectInput(
  "borough_choice",
  h3("Borough"),
  choices = borough_choices,
  selected = "Manhattan")

selectInput(
  "choices",
  h3("Choose a characteristic to map"),
  choices = list("Race", "Employment Type", "Co-parenting Status", "Family Income"))

conditionalPanel(
  condition = "input.choices == 'Race'",
  radioButtons(
  "race",
  h3("Race"),
  choices = race))

conditionalPanel(
  condition = "input.choices == 'Employment Type'",
  radioButtons(
  "employment",
  h3("Employment Type"),
  choices = employment))

conditionalPanel(
  condition = "input.choices == 'Co-parenting Status'",
  radioButtons(
  "partner",
  h3("Co-parenting Status"),
  choices = partner))

conditionalPanel(
  condition = "input.choices == 'Education'",
  radioButtons(
  "education",
  h3("Education"),
  choices = education))

conditionalPanel(
  condition = "input.choices == 'Family Income'",
  selectInput(
  "family_income",
  h3("Family Income"),
  choices = family_income,
  selected = "Less than $16,000"))

# rsconnect::deployApp("./meb2308_shiny.Rmd")
```

Column
----------------------------------------------------------------------


